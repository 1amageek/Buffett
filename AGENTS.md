# Buffettアプリケーション仕様書

## プロジェクト概要

macOSのネイティブアプリケーションで、個人投資家がリアルタイムの株価分析を行い、高度なチャート表示、テクニカル分析、銘柄管理を行えるようにする。将来的には高機能な分析とユーザーインターフェースを備えた株式分析プラットフォームとして進化させる。

## 開発環境

* **対象OS**: macOS 14以上
* **使用言語**: Swift 6.1以上
* **開発環境**: Xcode 16以上

## 使用技術・ライブラリ

* SwiftUI
* Swift Charts
* Swift OpenAPI Generator（将来的なAPI仕様の整備用）
* Swift Package Manager（SPM）
* Swift Testing
* **楽天証券 マーケットスピードII API（RSS）**

## 機能要件

### 株価データ管理

* リアルタイム株価データ取得（現在値、気配、歩み値）
* 銘柄ごとにカテゴリ分類可能
* 複数銘柄の同時チャート表示（最大500銘柄まで）

### テクニカル分析機能

以下の指標をリアルタイムに計算・表示：

* 単純移動平均線 (SMA)
* 指数平滑移動平均線 (EMA)
* MACD（Moving Average Convergence Divergence）
* RSI（Relative Strength Index）
* ボリンジャーバンド（Bollinger Bands）
* 一目均衡表（Ichimoku Cloud）
* 出来高加重平均価格 (VWAP)

### チャート表示

* Swift Chartsによるインタラクティブなチャート描画
* マルチチャート表示に対応

### コメント・キャンバス機能

* チャート上へのコメント追加
* ユーザー分析内容の視覚的保存（キャンバス）

## アーキテクチャ

* MVVM（Model-View-ViewModel）構成
* テスト可能な設計とSwift Testingの導入
* APIロジックとUIロジックの分離（SPMモジュール分割）

## システム構成

### モジュール分割

* **APIモジュール**（RakutenStockAPI）:

  * 楽天RSSを通じたリアルタイムデータ取得
  * 提供API：

    * `RssMarket`: 現在値、気配値、VWAP、四本値など
    * `RssTickList`: 歩み値（ティックデータ）
    * `RssChart`, `RssChartPast`: OHLCVチャートデータ（日足・分足等）
    * `RssTrendSMA`: 単純移動平均の算出
    * `RssMarginInfo`: 信用取引関連情報（買残、売残、信用倍率）
    * `RssRanking`: 値上がり率や出来高などのランキングデータ
    * `RssIssueInfo`: 銘柄基本情報
    * `RssHoldStock`, `RssAccountInfo`: 保有株、口座状況（参考）

* **UIモジュール**（BuffettApp）:

  * SwiftUIとChartsによる表示・操作インターフェース

## マイルストーン

### マイルストーン1: 環境構築とAPI基盤

* SPM構成とモジュール設計（RakutenStockAPI / Buffett）
* 楽天証券RSS連携確認、基本データ取得の実装

### マイルストーン2: チャート描画

* Swift Chartsでの株価描画
* 複数銘柄の表示、カテゴリ分け実装

### マイルストーン3: テクニカル指標

* OHLCVデータ取得処理の整備
* テクニカル指標（SMA、EMA、MACD等）の実装
* チャートとの統合表示

### マイルストーン4: コメント・キャンバス

* チャートアノテーション機能
* 分析ノートやスクラップ的キャンバス機能実装

## 非機能要件

* パフォーマンス最適化（最大500銘柄のリアルタイム更新）
* UI応答性の確保（非同期処理の適切な管理）
* エラー処理・データ整合性の確保

## 制約事項

* 楽天証券の証券口座とマーケットスピードII（Windowsアプリ）のログインが必要
* APIはマーケットスピードII起動中に限り有効
* 利用は個人投資目的に限定、条件付きで無料（預かり資産等）
* テクニカル指標（MACD、RSI等）はクライアント側で独自に算出する必要あり
* PUSH型ではなく、すべてPULLベースでのデータ取得（ポーリング設計が必要）

## 成功基準

* 株価・信用情報のリアルタイム取得と正確な表示
* 高機能かつ直感的なチャート・分析UI
* 拡張可能な設計と保守性の高いコードベース

この仕様に基づき、Swiftネイティブアプリとしての堅牢な株式分析ツールを段階的に構築していきます。
